// Generated by CoffeeScript 1.7.1
(function() {
  'use strict';
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  Game.Canvas1945 = (function(_super) {
    __extends(Canvas1945, _super);

    Canvas1945.VERSION = '1.0.0';

    Canvas1945.Width = 640;

    Canvas1945.LevelWidth = 640;

    Canvas1945.Height = 480;

    Canvas1945.LevelHeight = 410;

    Canvas1945.ScrollSpeed = 100;

    function Canvas1945() {
      this.ready = __bind(this.ready, this);
      Canvas1945.__super__.constructor.apply(this, arguments);
      this.canvas = this._createCanvas();
      this.stage = this.container = new createjs.Stage(this.canvas);
      this._setTicker();
      this._setInput(this.canvas);
      Object.defineProperty(this, 'paused', {
        get: function() {
          return createjs.Ticker.getPaused();
        },
        set: function(value) {
          return createjs.Ticker.setPaused(value);
        }
      });
      this.addLogic('collisions', this.collisions = new Game.CollisionManager());
      this._createPersistantData();
      this._createLayers();
      this._createDebug();
      Game.AssetManager.load(this.ready, this.get('menu').onProgress);
    }

    Canvas1945.prototype.ready = function() {
      return this.get('menu').ready();
    };

    Canvas1945.prototype._setTicker = function() {
      createjs.Ticker.addEventListener("tick", this.update);
      createjs.Ticker.useRAF = true;
      createjs.Ticker.setFPS(120);
      return this;
    };

    Canvas1945.prototype._setInput = function(canvas) {
      if (canvas == null) {
        canvas = this.canvas;
      }
      canvas.onkeydown = (function(_this) {
        return function(event) {
          _this.input(event, true);
          return false;
        };
      })(this);
      canvas.onkeyup = (function(_this) {
        return function(event) {
          _this.input(event, false);
          return false;
        };
      })(this);
      return this;
    };

    Canvas1945.prototype._createCanvas = function() {
      var canvas, container;
      canvas = document.createElement('canvas');
      canvas.id = 'game';
      canvas.setAttribute('width', Canvas1945.Width);
      canvas.setAttribute('height', Canvas1945.Height);
      canvas.setAttribute('tabindex', 0);
      container = document.getElementById("container");
      container.appendChild(canvas);
      canvas.focus();
      canvas.onmousedown = function(event) {
        canvas.focus();
        return false;
      };
      return canvas;
    };

    Canvas1945.prototype._createLayers = function() {
      this.add('background', new Game.Container());
      this.add('level', this.level = new Game.Level(this));
      this.add('foreground', new Game.Container());
      this.add('hud', new Game.Container());
      this.add('menu', new Game.Menu(this));
      return this;
    };

    Canvas1945.prototype._createPersistantData = function() {
      this.data = new Game.Data();
      return this;
    };

    Canvas1945.prototype._createDebug = function() {
      this.addTo('hud', 'fps', new Display.FPS());
      return this;
    };

    Canvas1945.prototype._removeLayers = function() {
      this.remove('menu');
      this.remove('hud');
      this.remove('foreground');
      this.remove('level');
      this.remove('background');
      return this;
    };

    Canvas1945.prototype.createLevel = function(level) {
      console.log("Starting level " + level);
      this.level.create(level);
      return this.remove('menu');
    };

    Canvas1945.prototype.die = function() {
      if ((--this.data.lives) > 0) {
        this.data.save();
        return this.level.restart();
      } else {
        this.pause();
        return this.data.truncate();
      }
    };

    Canvas1945.prototype.pause = function() {
      return createjs.Ticker.setPaused(true);
    };

    Canvas1945.prototype.resume = function() {
      return createjs.Ticker.setPaused(false);
    };

    Canvas1945.prototype.addLogic = function(key, object) {
      this.objects[key] = object;
      return this;
    };

    Canvas1945.prototype.update = function(event) {
      Canvas1945.__super__.update.call(this, event);
      this.stage.update();
      return this;
    };

    return Canvas1945;

  })(Game.Container);

}).call(this);
